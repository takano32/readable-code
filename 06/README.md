# 6. コメントは正確で簡潔に

コメントを正確で簡潔に書くための方法

**コメントは領域に対する情報の比率が高くなければいけない**

## 6-1. コメントを簡潔にしておく

悪い例

```
// int は CategoryType。
// pair の最初の float は 'score'。
// 2 つめは 'weight'。
typedef hash_map<int, pair<float, float> > ScoreMap;
```

良い例

```
// CategoryType -> (score, weight)
typedef hash_map<int, pair<float, float> > ScoreMap;
```

**意味が同じことを長く説明する必要はない**

## 6-2. あいまいな代名詞を避ける

悪い例

```
// データをキャッシュに入れる。ただし、先にそのサイズをチェックする。
```

良い例

```
// データをキャッシュに入れる。ただし、先にデータのサイズをチェックする。
```

全体を書き換えても良い

```
// データが十分に小さければ、それをキャッシュに入れる。
```

**代名詞の数だけ読み手は代名詞の還元を行う**

**なるべく代名詞の還元をさせない**

## 6-3. 歯切れの悪い文章を磨く

悪い例

```
# これまでにクロールした URL かどうかによって優先度を変える。
```

良い例

```
# これまでにクロールしていない URL の優先度を高くする。
```

**直訳したロジックのコメントは洗練の余地がある**

## 6-4. 関数の動作を正確に記述する

悪い例

```
// このファイルに含まれる行数を返す。 
int CountLines(string filename) { ... }
```

良い例

```
// このファイルに含まれる改行文字('\n')を数える。 
int CountLines(string filename) { ... }
```

**コメントから挙動が唯一に解釈できるよう記述する**

### 備考: 「行」によって発生する曖昧さ

「行」という表現は多様な意味を表すことができる

* ""(空のファイル)は、0 行なのか 1 行なのか。
* "hello" は、0 行なのか 1 行なのか。
* "hello\n" は、1 行なのか 2 行なのか。
* "hello\n world" は、1 行なのか 2 行なのか。
* "hello\n\r cruel\n world\r" は、2 行なのか 3 行なのか 4 行なのか。



## 6-5. 入出力のコーナーケースに実例を使う

悪い例

```
// 'src' の先頭や末尾にある 'chars' を除去する。 
String Strip(String src, String chars) { ... }
```

疑問点

* chars は、除去する文字列なのか、順序のない文字集合なのか?
* src の末尾に複数の chars があったらどうなるのか?

疑問点をカバーできていない例

```
// ...
// 実例:Strip("ab", "a") は "b" を返す
String Strip(String src, String chars) { ... }
```

* 単純すぎる実例では不十分

良い例

```
// ...
// 実例:Strip("abba/a/ba", "ab") は "/a/" を返す 
String Strip(String src, String chars) { ... }
```


悪い例 2.

```
// 'v' の「要素 < pivot」が「要素 >= pivot」の前に来るように配置し直す。 
// それから、「v[i] < pivot」になる最大の 'i' を返す(なければ -1 を返す)。 
int Partition(vector<int>* v, int pivot);
```

* 視覚化が厳しい

改善例 2.

```
// ...
// 実例:Partition([8 5 9 8 2], 8) の結果は [5 2 | 8 9 8] となり、1 を返す。 
int Partition(vector<int>* v, int pivot);
```

留意点 2.

* pivot をベクタの要素と同じにして、エッジケースを示している
* ベクタに重複要素(8)を入れることで、これが入力値として受け入れられることを示している
* 結果のベクタはソートしていない。ここでソートしていたら、ソートしなければいけないと読み手が誤解する可能性がある
* 戻り値が 1 になるので、ベクタの要素に 1 を入れていない

## 6-6. コードの意図を書く

悪い例

[![Image from Gyazo](https://i.gyazo.com/3e4ba131f09b2d8ce1f6abd653d50c8d.png)](https://gyazo.com/3e4ba131f09b2d8ce1f6abd653d50c8d)

良い例

[![Image from Gyazo](https://i.gyazo.com/e28552dff4d01aac430e3ff2d3903f26.png)](https://gyazo.com/e28552dff4d01aac430e3ff2d3903f26)

**コードの挙動をコメントするのではなく、作者の意図をコメントする**

## 6-7. 「名前付き引数」コメント

以下の関数について考える

```
Connect(10, false);
```

Python では名前付き引数を用いてコメントと引数の意味を補足できる

```
def Connect(timeout, use_encryption): ... 
```

```
# 名前付き引数で関数を呼び出す
Connect(timeout = 10, use_encryption = False)
```

名前付き引数が使えないプログラミング言語でもインラインコメントで同じような効果を得られる

```
void Connect(int timeout, bool use_encryption) { ... } 
```

```
// 引数にコメントをつけて関数を呼び出す
Connect(/* timeout_ms = */ 10, /* use_encryption = */ false);
```

### 備考: インラインコメントの順番によっては分かりにくいので注意

ブール型で顕著

```
// これはやってはいけない!
Connect( ... , false /* use_encryption */);
```

```
// これもやってはいけない!
Connect( ... , false /* = use_encryption */);
```

```
// これがいい!
Connect( ... , /* use_encryption = */ false);
```


## 6-8. 情報密度の高い言葉を使う

悪い例

```
// このクラスには大量のメンバがある。同じ情報はデータベースにも保管されている。ただし、 
// 速度の面からここにも保管しておく。このクラスを読み込むときには、メンバが存在してい 
// るかどうかを先に確認する。もし存在していれば、そのまま返す。存在しなければ、データベー 
// スから読み込んで、次回のためにデータをフィールドに保管する。
```

良い例

```
// このクラスの役割は、データベースのキャッシュ層である。
```

悪い例 2.

```
// 所在地から余分な空白を除去する。それから「Avenue」を「Ave.」にするなどの整形を施す。 
// こうすれば、表記がわずかに違う所在地でも同じものであると判別できる。
```

良い例 2.

```
// 所在地を正規化する(例:"Avenue" -> "Ave.")。
```

**専門的な用語は物事をややこしく説明するためだけにあるわけではない**

## 6-9. まとめ

**小さな領域にできるだけ情報を詰め込むことで良いコメントになる**

* 複数のものを指す可能性がある「それ」や「これ」などの代名詞を避ける
* 関数の動作はできるだけ正確に説明する
* コメントに含める入出力の実例を慎重に選ぶ
* コードの意図は、詳細レベルではなく、高レベルで記述する
* よくわからない引数にはインラインコメントを使う(例: `Function(/* arg = */ ... )` )
* 多くの意味が詰め込まれた言葉や表現を使って、コメントを簡潔に保つ

